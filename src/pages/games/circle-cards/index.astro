---
const SITE_NAME = "The-Circle";
const API_BASE = import.meta.env.PUBLIC_CC_API;
const API_URL = (API_BASE || "https://circle-cards-api.thegamestoners.workers.dev").replace(/\/+$/, "");
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Circle Cards • Games • {SITE_NAME}</title>
    <meta name="description" content="Create a Circle Cards room and play together. Async-friendly party game." />
    <link rel="icon" href="/favicon.png" type="image/png" />
  </head>

  <body>
    <main class="wrap">
      <header class="hero">
        <h1>Circle Cards</h1>
        <p class="lead">
          CAH-style rules: join a room, get a hand, submit a card, czar picks the winner.
          <span class="muted">4+ players recommended.</span>
        </p>
      </header>

      <section class="card">
        <button id="create" class="btn primary">Create Room</button>
        <p id="out" class="muted small"></p>

        <p class="tiny muted">
          API in use: <span class="mono">{API_URL}</span>
        </p>
      </section>

      <section class="card">
        <h2>Join existing room</h2>
        <p class="muted small">Paste a room ID (the part after /circle-cards/)</p>
        <div class="row">
          <input id="roomId" placeholder="e.g. 7zwio30" />
          <button id="go" class="btn">Go</button>
        </div>
        <p id="joinOut" class="muted small"></p>
      </section>
    </main>

    <script>
      const API = "{API_URL}";
      const out = document.getElementById("out");
      const joinOut = document.getElementById("joinOut");

      document.getElementById("create").onclick = async () => {
        out.textContent = "Creating room…";

        let r;
        try {
          r = await fetch(API + "/api/rooms", { method: "POST" });
        } catch (e) {
          out.textContent = "Network error: " + (e?.message || e);
          return;
        }

        const text = await r.text();
        let data = {};
        try { data = JSON.parse(text); } catch {}

        if (!r.ok) {
          out.textContent = data.error || `Failed (${r.status}): ${text.slice(0, 220)}`;
          return;
        }

        // If your worker returns hostToken on create, keep it.
        if (data.hostToken && data.roomId) localStorage.setItem("cc_host_" + data.roomId, data.hostToken);

        location.href = "/games/circle-cards/" + data.roomId;
      };

      document.getElementById("go").onclick = () => {
        const v = (document.getElementById("roomId").value || "").trim();
        if (!v) { joinOut.textContent = "Enter a room ID."; return; }
        // basic sanitize
        const roomId = v.replace(/[^a-z0-9]/gi, "");
        if (!roomId) { joinOut.textContent = "Invalid room ID."; return; }
        location.href = "/games/circle-cards/" + roomId;
      };
    </script>

    <style>
      body{ margin:0; font-family:system-ui; background:#070a0f; color:#fff; }
      .wrap{ max-width:820px; margin:40px auto; padding:0 18px; }
      .hero{ margin-bottom:22px; }
      h1{ margin:0 0 6px; font-size:40px; }
      h2{ margin:0 0 10px; font-size:18px; }
      .lead{ color:rgba(255,255,255,.72); max-width:72ch; }
      .card{ border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); border-radius:18px; padding:18px; margin:14px 0; }
      .row{ display:flex; gap:10px; flex-wrap:wrap; }
      input{
        flex:1;
        min-width: 220px;
        width:100%;
        box-sizing:border-box;
        padding:10px;
        border-radius:12px;
        border:1px solid rgba(255,255,255,.14);
        background:rgba(0,0,0,.25);
        color:#fff;
      }
      .btn{ padding:12px 18px; border-radius:14px; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.05); color:#fff; font-weight:800; cursor:pointer; }
      .btn.primary{ border-color:rgba(9,255,3,.55); background:rgba(9,255,3,.14); }
      .muted{ color:rgba(255,255,255,.68); }
      .small{ font-size:13px; }
      .tiny{ font-size:12px; margin-top:10px; }
      .mono{ font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    </style>
  </body>
</html>
