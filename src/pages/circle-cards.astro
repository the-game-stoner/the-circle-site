---
const SITE_NAME = "The-Circle";
const API_BASE = import.meta.env.PUBLIC_CC_API;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Circle Cards • {SITE_NAME}</title>
    <meta name="description" content="Create a Circle Cards room and share it in Discord." />
  </head>

  <body>
    <main class="wrap">
      <h1>Circle Cards</h1>
      <p class="muted">Create a room, drop the link in Discord, let people submit whenever.</p>

      <div class="card">
        <label for="prompt">Prompt (black card)</label>
        <textarea id="prompt" placeholder="The worst thing to say in voice chat is: _______"></textarea>

        <button id="create" class="btn primary">Create Room</button>
        <p id="out" class="muted small"></p>

        <p class="muted tiny">
          API: <span class="mono">{API_BASE || "MISSING PUBLIC_CC_API"}</span>
        </p>
      </div>
    </main>

    <script>
      const API = "{API_BASE || ''}";
      const out = document.getElementById("out");
      const promptEl = document.getElementById("prompt");

      document.getElementById("create").addEventListener("click", async () => {
        if (!API) {
          out.textContent = "Missing PUBLIC_CC_API env var. Add it in Cloudflare Pages settings.";
          return;
        }

        out.textContent = "Creating…";

        const r = await fetch(API.replace(/\/+$/, "") + "/api/rooms", {
          method: "POST",
          headers: { "content-type": "application/json" },
          body: JSON.stringify({ prompt: promptEl.value }),
        });

        const data = await r.json().catch(() => ({}));
        if (!r.ok) {
          out.textContent = data.error || "Error creating room";
          return;
        }

        localStorage.setItem("cc_host_" + data.roomId, data.hostToken);
        location.href = "/circle-cards/" + data.roomId;
      });
    </script>

    <style>
      body{ margin:0; font-family: system-ui; background:#070a0f; color:#fff; }
      .wrap{ max-width:820px; margin:40px auto; padding:0 18px; }
      h1{ margin:0 0 8px; }
      .card{ border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); padding:18px; border-radius:16px; margin:14px 0; }
      label{ display:block; font-weight:800; margin-bottom:8px; }
      textarea{ width:100%; min-height:110px; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background:rgba(0,0,0,.25); color:#fff; }
      .btn{ padding:12px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.06); color:#fff; font-weight:800; cursor:pointer; margin-top:10px; }
      .btn.primary{ border-color: rgba(9,255,3,.55); background: rgba(9,255,3,.12); }
      .muted{ color: rgba(255,255,255,.68); }
      .small{ font-size: 13px; }
      .tiny{ font-size: 12px; margin-top:12px; }
      .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    </style>
  </body>
</html>
